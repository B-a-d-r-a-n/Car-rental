<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Car Reviews</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- FontAwesome for Stars -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Review Cards */
        #reviews-list .card {
            background-color: #f2f2f2;
            border-radius: 20px;
            min-height: 200px;
            padding: 40px 40px 0px;
            border: none;
        }

        /* Review Form */
        #review-form input,
        #review-form select,
        #review-form textarea,
        #review-form button {
            padding: 20px;
            border-radius: 20px;
        }

        #review-form input:focus,
        #review-form select:focus,
        #review-form textarea:focus {
            box-shadow: none;
            border-color: #b5b5b5;
        }

        #review-form button {
            background-color: transparent;
            color: black;
            transition: all 500ms ease;
            border: 1px solid #f5b754;
        }

        #review-form button:hover {
            background-color: #f5b754;
            color: white;
        }
    </style>
</head>

<body>

    <!-- Reviews Section -->
    <section id="reviews-section" class="container mt-5">
        <h2>What Clients Say</h2>
        <div id="reviews-list" class="row mt-4">
            
        </div>
    </section>

    <!-- Add Review Section -->
    <section id="add-review-section" class="container mt-5 mb-5">
        <h3>Write a Review</h3>
        <form id="review-form" class="mt-4">
            <input type="text" id="customerName" class="form-control mb-2" placeholder="Your Name" required />
            <select id="rating" class="form-select mb-2" required>
                <option value="">Rating</option>
                <option value="5">5 - Excellent</option>
                <option value="4">4 - Good</option>
                <option value="3">3 - Average</option>
                <option value="2">2 - Poor</option>
                <option value="1">1 - Terrible</option>
            </select>
            <textarea id="comment" class="form-control mb-2" placeholder="Your Review" rows="4" required></textarea>
            <button type="submit" class="btn btn-primary">Submit Review</button>
        </form>
    </section>

    <!-- Scripts -->
    <script src="Entities.js"></script>
    <script src="initialize-data-js.js"></script>

    <script>

        const carId = 6; 

        function loadReviewsForCar(carId) {
            const reviews = JSON.parse(localStorage.getItem("reviews")) || [];
            const carReviews = reviews.filter(review => review.carId === carId);
            const reviewsList = document.getElementById("reviews-list");

            reviewsList.innerHTML = "";

            if (carReviews.length === 0) {
                reviewsList.innerHTML = `<div class="alert alert-info">No reviews yet. Be the first to review this car!</div>`;
                return;
            }

            carReviews.forEach(review => {
                const reviewCard = document.createElement("div");
                reviewCard.classList.add("col-md-6");

                reviewCard.innerHTML = `
                    <div class="card mb-3">
                    <div class="card-body d-flex flex-column">
                        <div class="mb-2">
                        <h5 class="card-title mb-0">${review.customerName}</h5>
                        </div>
                        <div class="mb-3">
                        ${renderStars(review.rating)}
                        </div>
                        <p class="card-text">${review.comment}</p>
                        <p class="card-text text-end mt-auto">
                        <small class="text-muted">${new Date(review.date).toLocaleDateString()}</small>
                        </p>
                    </div>
                    </div>
                `;

                reviewsList.appendChild(reviewCard);
            });
        }

        // stars
        function renderStars(rating) {
            let stars = "";
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += `⭐ `;
                } else {
                    stars += `<i class="far fa-star text-warning"></i> `;
                }
            }
            return stars;
        }

        // save new reivew to localStorage
        document.getElementById("review-form").addEventListener("submit", function (e) {
            e.preventDefault();

            const customerName = document.getElementById("customerName").value.trim();
            const rating = parseInt(document.getElementById("rating").value);
            const comment = document.getElementById("comment").value.trim();

            if (!customerName || !rating || !comment) {
                alert("Please fill all fields.");
                return;
            }

            const reviews = JSON.parse(localStorage.getItem("reviews")) || [];

            const newReview = new Review(
                reviews.length > 0 ? reviews[reviews.length - 1].id + 1 : 1,
                carId,
                customerName,
                rating,
                comment
            );

            reviews.push(newReview);
            localStorage.setItem("reviews", JSON.stringify(reviews));

            // تحديث العرض
            loadReviewsForCar(carId);

            // تفريغ الفورم
            document.getElementById("review-form").reset();

            // ملاحظة نجاح
            // alert("Review submitted successfully!");
        });

        // تحميل الريفيوز عند فتح الصفحة
        loadReviewsForCar(carId);
    </script>

</body>

</html>